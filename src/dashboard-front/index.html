<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link href="/favicon.png" rel="icon" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>API Gateway | 腾讯蓝鲸智云</title>
  </head>
  <body>
    <div id="app"></div>
    <script>
      var BK_DASHBOARD_URL = globalThis.runtimeEnv?.BK_DASHBOARD_URL || "/";
      window.BK_SITE_PATH = "/";
      window.BK_STATIC_URL = "/";
    </script>
    <script>
      window.__loadAssetsUrl__ = function (src) {
        function joinPath(...paths) {
          // 过滤 null/undefined
          const validPaths = paths.filter((p) => p != null).map(String);

          if (validPaths.length === 0) return "";

          // 检查是否以根路径开头
          const startsWithRoot = validPaths[0].startsWith("/");

          // 标准化每个路径片段：移除首尾多余斜杠
          const normalized = validPaths
            .map((p, i) => {
              if (i === 0) {
                // 第一个路径：只移除尾部斜杠（保留开头的 /）
                return p.replace(/[\/]+$/, "");
              } else {
                // 其他路径：移除首尾斜杠
                return p.replace(/^[\/]+|[\/]+$/g, "");
              }
            })
            .filter((p) => p !== "");

          // 拼接
          let result = normalized.join("/");

          // 如果原始第一个路径是根路径，确保结果以 / 开头
          if (startsWithRoot && result !== "") {
            result = "/" + result.replace(/^\/+/, "");
          }

          return result || (startsWithRoot ? "/" : "");
        }
        return joinPath(window.BK_STATIC_URL, src);
      };

      function loadScript(src) {
        const script = document.createElement("script");
        script.src = window.__loadAssetsUrl__(src);
        script.type = "module";
        document.body.appendChild(script);
      }

      function loadStyle(href) {
        const link = document.createElement("link");
        link.type = "text/css";
        link.rel = "stylesheet";
        link.href = window.__loadAssetsUrl__(href);
        document.head.appendChild(link);
      }

      loadScript("/bk_icon_font/iconcool.js");
      loadStyle("/bk_icon_font/style.css");

      fetch(window.__loadAssetsUrl__(".vite/manifest.json"))
        .then((res) => res.json())
        .then((data) => {
          Object.values(data).forEach((item) => {
            if (!item.isEntry) {
              return;
            }
            console.log(item);
            loadScript(item.file);
            item.css.forEach((asset) => {
              loadStyle(asset);
            });
          });

          console.log(data);
        });
    </script>
  </body>
</html>
