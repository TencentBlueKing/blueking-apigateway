<template>
  <div v-show="common.curApigwData?.kind !== 1">
    <ResourceSettingTopBar
      :current-source="curResource"
      :is-detail="isDetail"
      :latest="versionConfigs.needNewVersion"
      :show-new-tips="!!tableData?.length"
    />
    <div
      id="resourceId"
      :class="[
        'resource-container',
        'page-wrapper-padding',
        isDragging ? 'dragging' : '',
        isDetail && !isShowLeft ? 'welt' : ''
      ]"
    >
      <div
        id="resourceLf"
        :style="{ minWidth: isDetail ? isShowLeft ? '320px' : '0' : '100%' }"
        class="resource-container-lf"
      >
        <bk-alert
          v-show="versionConfigs.needNewVersion && !isDetail"
          class="mb20"
          theme="warning"
        >
          <template #title>
            {{ versionConfigs.versionMessage }}
            <bk-button
              v-if="versionConfigs.needNewVersion"
              text
              theme="primary"
              @click="handleCreateResourceVersion"
            >
              {{ t('立即生成版本') }}
            </bk-button>
          </template>
        </bk-alert>
        <div class="operate flex-row justify-content-between mb15">
          <div class="flex-1 flex-row align-items-center">
            <div class="mr8">
              <bk-button
                v-show="isShowLeft && !showBatch"
                :class="{ 'super-big-button': isDetail }"
                style="width: 142px;"
                theme="primary"
                @click="handleCreateResource"
              >
                {{ t('新建') }}
              </bk-button>
            </div>
            <!-- <ag-dropdown
            v-show="isShowLeft"
            :text="t('批量')"
            :dropdown-list="batchDropData"
            @on-change="handleBatchOperate"
            :is-disabled="!selections.length"></ag-dropdown> -->
            <bk-button
              v-show="!showBatch"
              class="mr8"
              @click="handleShowBatch"
            >
              {{ t('批量操作') }}
            </bk-button>
            <div v-show="showBatch" class="batch-status">
              <bk-button
                class="mr8"
                @click="handleBatchOperate('edit')"
              >
                {{ t('编辑资源') }}
              </bk-button>
              <bk-button
                class="mr8"
                @click="handleBatchOperate('delete')"
              >
                {{ t('删除资源') }}
              </bk-button>
            </div>
            <ag-dropdown
              v-show="isDetail && isShowLeft"
              :text="t('更多')"
            >
              <div class="nest-dropdown">
                <ag-dropdown
                  :dropdown-list="importDropData"
                  :is-text="true"
                  :text="t('导入')"
                  placement="right-start"
                  @on-change="handleImport"
                ></ag-dropdown>
                <ag-dropdown
                  :dropdown-list="exportDropData"
                  :is-text="true"
                  :text="t('导出')"
                  placement="right-start"
                  @on-change="handleExport"
                ></ag-dropdown>
              </div>
            </ag-dropdown>
            <section v-show="!isDetail" class="flex-row align-items-center">
              <ag-dropdown
                v-show="!showBatch"
                :dropdown-list="importDropData"
                :text="t('导入')"
                @on-change="handleImport"
              ></ag-dropdown>
              <ag-dropdown
                :dropdown-list="exportDropData"
                :text="t('导出')"
                @on-change="handleExport"
              ></ag-dropdown>
            </section>

            <span v-show="!isDetail" :class="['split-line', showBatch ? 'batch' : '']"></span>

            <div v-show="!showBatch && !isDetail" class="operate-btn-wrapper">
              <bk-button class="operate-btn mr8" @click="handleShowDiff">
                <i class="apigateway-icon icon-ag-chayiduibi-shixin"></i>
                {{ t('与历史版本对比') }}
              </bk-button>

              <bk-badge
                v-if="versionConfigs.needNewVersion"
                dot
                position="top-right"
                theme="danger"
              >
                <bk-button
                  v-bk-tooltips="{
                    content: t('资源有更新，可生成新版本'),
                  }"
                  class="operate-btn"
                  @click="handleCreateResourceVersion"
                >
                  <i class="apigateway-icon icon-ag-version"></i>
                  {{ t('生成版本') }}
                </bk-button>
              </bk-badge>
              <bk-button
                v-else
                v-bk-tooltips="{
                  content: t('资源无更新，无需生成版本'),
                }"
                :disabled="true"
                class="operate-btn"
              >
                <i class="apigateway-icon icon-ag-version"></i>
                {{ t('生成版本') }}
              </bk-button>

            </div>
            <bk-button
              v-show="showBatch"
              class="operate-btn"
              outline
              theme="primary"
              @click="handleOutBatch"
            >
              <i class="apigateway-icon icon-ag-chahao"></i>
              {{ t('退出批量编辑') }}
            </bk-button>
          </div>
          <div class="search-select-wrap">
            <bk-search-select
              v-show="!isDetail"
              v-model="searchValue"
              :data="searchData"
              :placeholder="t('请输入资源名称或选择条件搜索, 按Enter确认')"
              :value-split-code="'+'"
              style="width: 100%; background:#fff"
              unique-select
            />
          </div>
        </div>
        <bk-search-select
          v-show="isDetail && isShowLeft"
          v-model="searchValue"
          :data="searchData"
          :placeholder="t('请输入资源名称或选择条件搜索, 按Enter确认')"
          :value-split-code="'+'"
          class="mb15"
          style="background:#fff"
          unique-select
        />

        <div v-show="isShowLeft" class="left-wraper">
          <bk-loading :loading="isLoading">
            <bk-table
              :key="tableDataKey"
              :data="tableData"
              :pagination="pagination"
              :row-class="handleRowClass"
              :settings="settings"
              :show-overflow-tooltip="true"
              border="outer"
              class="table-layout"
              remote-pagination
              row-key="id"
              @page-limit-change="handlePageSizeChange"
              @page-value-change="handlePageChange"
              @select-all="handleSelecAllChange"
              @selection-change="handleSelectionChange"
              @row-mouse-enter="handleMouseEnter"
              @row-mouse-leave="handleMouseLeave"
              @column-sort="handleSortChange"
            >
              <bk-table-column v-if="showBatch" align="center" fixed type="selection" width="80" />
              <bk-table-column :label="t('资源名称')" fixed prop="name" width="170">
                <template #default="{ row }">
                  <div class="resource-name">
                    <div
                      v-bk-tooltips="{ content: row?.name, placement: 'right', delay: 300, }"
                      :class="['name', { 'name-updated': row?.has_updated }]"
                      @click="handleShowInfo(row.id)"
                    >
                      {{ row?.name }}
                    </div>
                    <div
                      v-if="row?.has_updated"
                      v-bk-tooltips="{ content: '资源已更新', placement: 'right', delay: 300, }"
                      class="dot warning"
                    />
                  </div>
                </template>
              </bk-table-column>
              <bk-table-column
                :label="t('后端服务')"
                prop="backend_name"
                width="130"
              >
                <template #default="{ row }">
                  {{ row?.backend?.name }}
                </template>
              </bk-table-column>
              <bk-table-column
                :filter="{
                  list: customMethodsList,
                  checked: chooseMethod,
                  filterFn: handleMethodFilter,
                  btnSave: false,
                }"
                :label="t('前端请求方法')"
                :show-overflow-tooltip="false"
                prop="method"
                width="130"
              >
                <template #default="{ row }">
                  <bk-tag :theme="methodsEnum[row?.method]">{{ row?.method }}</bk-tag>
                </template>
              </bk-table-column>
              <bk-table-column
                :label="t('前端请求路径')"
                prop="path"
              >
              </bk-table-column>
              <bk-table-column
                :label="t('插件数')"
                prop="plugin_count"
                width="40"
              >
                <template #default="{ row }">
                  <div class="plugin-num" @click="handleShowInfo(row.id, 'pluginManage')">
                    {{ row?.plugin_count }}
                  </div>
                </template>
              </bk-table-column>
              <bk-table-column
                :label="t('文档')"
                prop="docs"
                width="80"
              >
                <template #default="{ row }">
                  <section v-if="row?.docs?.length" @click="handleShowDoc(row)">
                    <span class="document-info">
                      <i class="bk-icon apigateway-icon icon-ag-document"></i>
                      {{ $t('详情') }}
                    </span>
                  </section>
                  <section v-else>
                    <span v-show="!row?.isDoc">--</span>
                    <i
                      v-show="row?.isDoc"
                      v-bk-tooltips="t('添加文档')"
                      class="bk-icon apigateway-icon icon-ag-plus plus-class"
                      @click="handleShowDoc(row)"
                    ></i>
                  </section>
                </template>
              </bk-table-column>
              <bk-table-column
                :filter="{
                  list: labelsList,
                  checked: chooseLabels,
                  filterFn: handleMethodFilter,
                  btnSave: false,
                }"
                :label="t('标签')"
                :show-overflow-tooltip="false"
                min-width="180"
                prop="labels"
              >
                <template #default="{ row }">
                  <span v-if="!row?.isEditLabel" class="text-warp" @click="handleEditLabel(row)">
                    <span
                      v-if="row?.labels?.length"
                      v-bk-tooltips="{ content: tipsContent(row?.labelText), theme: 'light', placement: 'left' }"
                    >
                      <template v-for="(item, index) in row?.labels" :key="item.id">
                        <span v-if="index < row.tagOrder" style="margin-left: 4px;">
                          <bk-tag @click="handleEditLabel(row)">
                            {{ item.name }}
                          </bk-tag>
                        </span>
                      </template>
                      <bk-tag
                        v-if="row.labels.length > row.tagOrder"
                        class="tag-cls"
                        @click="handleEditLabel(row)"
                      >
                        +{{ row.labels.length - row.tagOrder }}
                      </bk-tag>
                    </span>
                    <span v-else>--</span>
                    <i
                      v-show="row?.isDoc"
                      class="icon apigateway-icon icon-ag-edit-small edit-icon"
                      @click="handleEditLabel(row)"
                    ></i>
                  </span>
                  <section v-else ref="selectCheckBoxParentRef">
                    <SelectCheckBox
                      :cur-select-label-ids="curLabelIds"
                      :labels-data="labelsData"
                      :resource-id="resourceId"
                      :width="selectCheckBoxParentRef?.offsetWidth"
                      force-focus
                      @close="(newLabelData) => {
                        handleCloseSelect(row, newLabelData)
                      }"
                      @update-success="handleUpdateLabelSuccess"
                      @label-add-success="getLabelsData"
                    ></SelectCheckBox>
                  </section>
                </template>
              </bk-table-column>
              <bk-table-column
                :label="t('更新时间')"
                :sort="true"
                prop="updated_time"
              >
              </bk-table-column>
              <bk-table-column
                :label="t('操作')"
                fixed="right"
                prop="act"
                width="150"
              >
                <template #default="{ data }">
                  <bk-button
                    text
                    theme="primary"
                    @click="handleEditResource(data.id, 'edit')"
                  >
                    {{ t('编辑') }}
                  </bk-button>

                  <bk-button
                    class="pl10 pr10"
                    text
                    theme="primary"
                    @click="handleEditResource(data.id, 'clone')"
                  >
                    {{ t('克隆') }}
                  </bk-button>

                  <bk-pop-confirm
                    :content="t('删除操作无法撤回，请谨慎操作')"
                    :title="t('确认删除资源{resourceName}？', { resourceName: data?.name || '' })"
                    trigger="click"
                    width="288"
                    @confirm="handleDeleteResource(data.id)"
                  >
                    <bk-button
                      text
                      theme="primary"
                    >
                      {{ t('删除') }}
                    </bk-button>
                  </bk-pop-confirm>
                </template>
              </bk-table-column>
              <template #empty>
                <TableEmpty
                  :abnormal="tableEmptyConf.isAbnormal"
                  :keyword="tableEmptyConf.keyword"
                  @reacquire="getSearchResourceList"
                  @clear-filter="handleClearFilterKey"
                />
              </template>
            </bk-table>
          </bk-loading>
        </div>

        <div
          v-show="isShowLeft"
          :class="['toggle-button', 'toggle-button-lf', !isDetail ? 'active' : '']"
          :style="{ right: !isDetail ? '-24px' : '-22px' }"
          @click="handleToggleLf"
        >
          <i class="icon apigateway-icon icon-ag-ag-arrow-left"></i>
        </div>
      </div>

      <div v-show="isDetail && isShowLeft" id="resourceLine" class="demarcation-button" draggable="true">
        <span>......</span>
      </div>

      <div
        v-show="isDetail"
        id="resourceRg"
        :class="['resource-container-rg', 'flex-1', isDragging ? 'dragging' : '']"
      >
        <div
          :class="['toggle-button', 'toggle-button-rg', !isShowLeft ? 'active' : '']"
          @click="handleToggleRg"
        >
          <i class="icon apigateway-icon icon-ag-ag-arrow-left"></i>
        </div>
        <div class="right-wraper">
          <bk-tab
            v-model:active="active"
            class="resource-tab-panel"
            type="card-tab"
          >
            <bk-tab-panel
              v-for="item in panels"
              :key="item.name"
              :label="item.label"
              :name="item.name"
              render-directive="if"
            >
              <bk-loading :loading="isComponentLoading" :opacity="1">
                <!-- deleted-success 删除成功需要请求一次列表数据 更新详情 -->
                <component
                  :is="item.component"
                  v-if="item.name === active && resourceId"
                  ref="componentRef"
                  :apigw-id="apigwId"
                  :cur-resource="curResource"
                  :resource-id="resourceId"
                  doc-root-class="doc-tab"
                  height="calc(100vh - 348px)"
                  @done="(v: boolean | any) => {
                    isComponentLoading = !!v
                  }"
                  @deleted-success="handleDeleteSuccess"
                  @on-jump="(id: number | any) => {
                    handleShowInfo(id)
                  }"
                />
              </bk-loading>
            </bk-tab-panel>
          </bk-tab>
        </div>
      </div>

      <!-- 批量删除dialog -->
      <bk-dialog
        :is-loading="dialogData.loading"
        :is-show="dialogData.isShow"
        :title="dialogData.title"
        quick-close
        theme="primary"
        width="600"
        @closed="handleBatchCancel"
        @confirm="handleBatchConfirm"
      >
        <div v-if="isBatchDelete" class="delete-content">
          <bk-table
            :columns="columns"
            :data="selections"
            max-height="280"
            row-hover="auto"
            show-overflow-tooltip
          />
          <bk-alert
            :title="t('删除资源后，需要生成新的版本，并发布到目标环境才能生效')"
            class="mt10 mb10"
            theme="warning"
          />
        </div>
        <div v-else>
          <bk-form>
            <bk-form-item :label="t('基本信息')">
              <bk-checkbox
                v-model="batchEditData.isPublic"
                @change="handlePublicChange"
              >
                {{ t('是否公开') }}
              </bk-checkbox>
              <bk-checkbox
                v-model="batchEditData.allowApply"
                :disabled="!batchEditData.isPublic"
              >
                {{ t('允许申请权限') }}
              </bk-checkbox>
            </bk-form-item>
            <bk-form-item :label="t('是否修改标签')">
              <div class="edit-labels-container">
                <bk-switcher
                  v-model="batchEditData.isUpdateLabels"
                  theme="primary"
                  @change="handleUpdateLabelsChange"
                />
                <SelectCheckBox
                  v-if="batchEditData.isUpdateLabels"
                  v-model="batchEditData.labelIds"
                  :bath-edit="true"
                  :cur-select-label-ids="[]"
                  :labels-data="labelsData"
                  class="select-labels"
                  @update-success="getLabelsData"
                  @label-add-success="getLabelsData"
                >
                </SelectCheckBox>
              </div>
            </bk-form-item>
          </bk-form>
        </div>
      </bk-dialog>

      <!-- 资源配置导出 -->
      <ExportResourceDialog
        v-model:dialog-config="exportDialogConfig"
        v-model:dialog-params="exportParams"
        :selections="selections"
        :is-show-export-content="false"
        @confirm="handleExportDownload"
      />

      <!-- 文档侧边栏 -->
      <ResourceDocSideSlider
        v-model="docSliderConf.isShowDocSide"
        :resource="curResource"
        :title="docSliderConf.title"
        @fetch="handleSuccess"
        @on-update="handleUpdateTitle"
      ></ResourceDocSideSlider>

      <!-- 生成版本 -->
      <version-sideslider ref="versionSidesliderRef" @done="mitt.emit('on-update-plugin');" />

      <!-- 版本对比 -->
      <bk-sideslider
        v-model:is-show="diffSidesliderConf.isShow"
        :quick-close="true"
        :title="diffSidesliderConf.title"
        :width="diffSidesliderConf.width"
      >
        <template #default>
          <div class="p20 pure-diff">
            <version-diff ref="diffRef" :source-id="diffSourceId" :target-id="diffTargetId" />
          </div>
        </template>
      </bk-sideslider>
    </div>
  </div>
  <page-not-found v-if="common.isProgrammableGateway" />
</template>
<script setup lang="ts">
import {
  computed,
  h,
  nextTick,
  onBeforeMount,
  onMounted,
  reactive,
  ref,
  shallowRef,
  watch,
} from 'vue';
import { useI18n } from 'vue-i18n';
import {
  onBeforeRouteLeave,
  useRoute,
  useRouter,
} from 'vue-router';
import {
  cloneDeep,
  differenceBy,
  uniqueId,
} from 'lodash';
import { Message } from 'bkui-vue';

import {
  useQueryList,
  useSelection,
} from '@/hooks';
import {
  batchDeleteResources,
  batchEditResources,
  checkNeedNewVersion,
  deleteResources,
  exportDocs,
  exportResources,
  getGatewayLabels,
  getResourceListData,
  getResourceVersionsList,
} from '@/http';
import Detail from './detail.vue';
import VersionSideslider from './comps/version-sideslider.vue';
import versionDiff from '@/components/version-diff/index.vue';
import SelectCheckBox from './comps/select-check-box.vue';
import AgDropdown from '@/components/ag-dropdown.vue';
import PluginManage from '@/views/components/plugin-manage/index.vue';
import ResourcesDoc from '@/views/components/resources-doc/index.vue';
import TableEmpty from '@/components/table-empty.vue';
// import RenderCustomColumn from '@/components/custom-table-header-filter';
import ResourceSettingTopBar from '@/views/resource/setting/comps/resource-setting-top-bar.vue';
import PageNotFound from '@/views/404.vue';
import mitt from '@/common/event-bus';
import {
  IDialog,
  IDropList,
  IExportDialog,
  IExportParams,
  MethodsEnum,
} from '@/types';
import { is24HoursAgo } from '@/common/util';
import {
  useCommon,
  useResourceSetting,
  useResourceVersion,
} from '@/store';
import ResourceDocSideSlider from '@/views/components/resource-doc-slider/index.vue';
import useMaxTableLimit from '@/hooks/use-max-table-limit';
import ExportResourceDialog from '@/components/export-resource-dialog/index.vue';

const props = defineProps({
  apigwId: {
    type: Number,
    default: 0,
  },
});

type TableEmptyConfType = {
  keyword: string
  isAbnormal: boolean
};

const leftWidth = ref('320px');
const methodsEnum: any = ref(MethodsEnum);
const common = useCommon();
const resourceVersionStore = useResourceVersion();
const resourceSettingStore = useResourceSetting();
const { t } = useI18n();
// 批量下拉的item
// const batchDropData = ref([{ value: 'edit', label: t('编辑资源') }, { value: 'delete', label: t('删除资源') }]);
// 导入下拉
const importDropData = ref([{ value: 'config', label: t('资源配置') }, { value: 'doc', label: t('资源文档') }]);
interface ApigwIDropList extends IDropList {
  tooltips?: string;
}
// 导出下拉
const exportDropData = ref<ApigwIDropList[]>([
  {
    value: 'all',
    label: t('全部资源'),
  },
  {
    value: 'filtered',
    label: t('已筛选资源'),
    disabled: false,
    tooltips: t('请先筛选资源'),
  },
  // { value: 'selected', label: t('已选资源'), disabled: false, tooltips: t('请先勾选资源') },
]);

const route = useRoute();
const router = useRouter();
const tableDataKey = ref(uniqueId());
const chooseMethod = ref<string[]>([]);
const filterData = ref<any>({ keyword: '', order_by: '' });
const chooseLabels = ref<string[]>([]);
const tableEmptyConf = ref<TableEmptyConfType>({
  keyword: '',
  isAbnormal: false,
});

// ref
const versionSidesliderRef = ref(null);
const selectCheckBoxParentRef = ref(null);
// 导出参数
const exportParams: IExportParams = reactive({
  export_type: '',
  file_type: 'yaml',
});

// 是否批量
const isBatchDelete = ref(false);

// 是否展示详情
const isDetail = ref(false);
// 是否展示左边列表
const isShowLeft = ref(true);

// 当前点击资源ID
const resourceId = ref(0);

// 当前点击的资源
const curResource: any = ref({});

const active = ref('resourceInfo');

const isComponentLoading = ref(true);

const methodsTypeList = ref(common.methodList);

const searchValue = ref([]);
const searchData = shallowRef([
  // {
  //   name: t('模糊查询'),
  //   id: 'keyword',
  //   placeholder: t('请输入资源名称，前端请求路径'),
  // },
  {
    name: t('资源名称'),
    id: 'name',
    placeholder: t('请输入资源名称'),
  },
  {
    name: t('前端请求路径'),
    id: 'path',
    placeholder: t('请输入前端请求路径'),
  },
  {
    name: t('前端请求方法'),
    id: 'method',
    placeholder: t('请选择前端请求方法'),
    children: methodsTypeList.value,
    multiple: true,
  },
  {
    name: t('后端服务'),
    id: 'backend_name',
    placeholder: t('请输入后端服务'),
  },
]);

// 标签数据
const labelsData = ref<any[]>([]);

// 当前点击行的选中的标签
const curLabelIds = ref<number[]>([]);

// 当前点击行的选中的标签备份
const curLabelIdsbackUp = ref<number[]>([]);

// 文档侧边栏数据
const docSliderConf: any = reactive({
  isShow: false,
  title: t('文档详情'),
  isLoading: false,
  isEdited: false,
  languages: 'zh',
});

// 批量删除dialog
const dialogData: IDialog = reactive({
  isShow: false,
  title: t(''),
  loading: false,
});

// 导出dialog
const exportDialogConfig: IExportDialog = reactive({
  isShow: false,
  title: t('请选择导出的格式'),
  loading: false,
  exportFileDocType: 'resource',
});

// 是否需要alert信息栏
const versionConfigs = reactive({
  needNewVersion: false,
  versionMessage: '',
});

const batchEditData = ref({
  isPublic: true,
  allowApply: true,
  isUpdateLabels: false,
  labelIds: [],
});

// 版本对比抽屉
const diffSidesliderConf = reactive({
  isShow: false,
  width: 1040,
  title: t('版本资源对比'),
});
const diffSourceId = ref();
const diffTargetId = ref();

// const showEdit = ref(false);
// const optionName = ref('');
// const inputRef = ref(null);

// tab 选项卡
const panels = [
  { name: 'resourceDetail', label: t('资源配置'), component: Detail },
  { name: 'pluginManage', label: t('插件管理'), component: PluginManage },
  { name: 'resourcesDoc', label: t('资源文档'), component: ResourcesDoc },
];

const columns = [
  {
    label: t('请求路径'),
    field: 'path',
  },
  {
    label: t('请求方法'),
    field: 'method',
  },
];

// const customMethodsList = shallowRef(common.methodList);
const customMethodsList = computed(() => {
  if (!common.methodList?.length) {
    return [];
  }
  return common.methodList?.map((item: any) => {
    return {
      text: item.name,
      value: item.id,
    };
  });
});

const handleMethodFilter = () => true;

// const curSelectMethod = ref('ALL');

// const renderMethodsLabel = () => {
//   return h('div', { class: 'resource-setting-custom-label' }, [
//     h(
//       RenderCustomColumn,
//       {
//         key: tableKey.value,
//         hasAll: true,
//         columnLabel: t('前端请求方法'),
//         selectValue: curSelectMethod.value,
//         list: customMethodsList.value,
//         onSelected: (value: Record<string, string>) => {
//           handleSelectMethod(value);
//         },
//       },
//     ),
//   ]);
// };

// const handleSelectMethod = (payload: Record<string, string>) => {
//   const { id, name } = payload;
//   filterData.value.method = payload.id;
//   const hasMethodData = searchValue.value.find((item: Record<string, any>) => ['method'].includes(item.id));
//   if (hasMethodData) {
//     hasMethodData.values = [{
//       id,
//       name,
//     }];
//   } else {
//     searchValue.value.push({
//       id: 'method',
//       name: t('前端请求方法'),
//       values: [{
//         id,
//         name,
//       }],
//     });
//   }
//   if (['ALL'].includes(payload.id)) {
//     delete filterData.value.method;
//     searchValue.value = searchValue.value.filter((item: Record<string, any>) => !['method'].includes(item.id));
//   }
// };

const labelsList = computed(() => {
  if (!labelsData?.value.length) {
    return [];
  }

  tableDataKey.value = uniqueId();

  return labelsData.value?.map((item: any) => {
    return {
      text: item.name,
      value: item.name,
    };
  });
});

// 当前视口高度能展示最多多少条表格数据
const maxTableLimit = useMaxTableLimit();

// 列表hooks
const {
  tableData,
  pagination,
  isLoading,
  handlePageChange,
  handlePageSizeChange,
  getList,
} = useQueryList(getResourceListData, filterData, 0, false, {
  limitList: [maxTableLimit, 10, 20, 50, 100],
  limit: maxTableLimit,
});

// checkbox hooks
const {
  selections,
  handleSelectionChange,
  handleSelecAllChange,
  resetSelections,
} = useSelection();

const init = () => {
  handleShowVersion();
  getLabelsData();
};

const getSearchResourceList = async () => {
  refreshTableData();
};

const refreshTableData = () => {
  getList();
  updateTableEmptyConfig();
};

const handleClearFilterKey = () => {
  filterData.value = cloneDeep({ keyword: '', order_by: '' });
  searchValue.value = [];
  chooseMethod.value = [];
  chooseLabels.value = [];
};

const updateTableEmptyConfig = () => {
  tableEmptyConf.value.isAbnormal = pagination.value.abnormal;
  if ((searchValue.value.length || chooseMethod.value?.length || chooseLabels.value?.length)
  && !tableData.value.length) {
    tableEmptyConf.value.keyword = 'placeholder';
    return;
  }
  if (searchValue.value.length || chooseMethod.value?.length || chooseLabels.value?.length) {
    tableEmptyConf.value.keyword = '$CONSTANT';
    return;
  }
  tableEmptyConf.value.keyword = '';
};

// isPublic为true allowApply才可选
const handlePublicChange = () => {
  batchEditData.value.allowApply = batchEditData.value.isPublic;
};

// 新建资源
const handleCreateResource = () => {
  router.push({
    name: 'apigwResourceCreate',
  });
};

// 编辑资源
const handleEditResource = (id: number, type: string) => {
  const name = type === 'edit' ? 'apigwResourceEdit' : 'apigwResourceClone';
  resourceVersionStore.setPageStatus({
    isDetail: false,
    isShowLeft: true,
  });
  router.push({
    name,
    params: {
      resourceId: id,
    },
  });
};

// 删除资源
const handleDeleteResource = async (id: number) => {
  await deleteResources(props.apigwId, id);
  Message({
    message: t('删除成功'),
    theme: 'success',
    width: 'auto',
  });
  handleSuccess();
};

const handleToggleLf = () => {
  if (isDetail.value) {
    isShowLeft.value = false;
  } else {
    isDetail.value = true;
    document.getElementById('resourceLf').style.width = leftWidth.value;
  }
};

const handleToggleRg = () => {
  if (isShowLeft.value) {
    isDetail.value = false;
    handleShowList();
  } else {
    isShowLeft.value = true;
  }
};

const isDragging = ref<boolean>(false);
const dragTwoColDiv = (contentId: string, leftBoxId: string, resizeId: string/* , rightBoxId: string */) => {
  const resize: any = document.getElementById(resizeId);
  const leftBox = document.getElementById(leftBoxId);
  // const rightBox = document.getElementById(rightBoxId);
  const box = document.getElementById(contentId);

  resize.onmousedown = function (e: any) {
    const startX = e.clientX;
    resize.left = resize.offsetLeft;
    isDragging.value = true;
    document.onmousemove = function (e) {
      const endX = e.clientX;
      let moveLen = resize.left + (endX - startX);
      const maxT = box.clientWidth - resize.offsetWidth;
      if (moveLen < 215) {
        moveLen = 0;
        isShowLeft.value = false;
        document.onmouseup(e);
      }
      if (moveLen > maxT - 770) {
        moveLen = maxT;
        handleShowList();
        document.onmouseup(e);
      }
      resize.style.left = moveLen;
      leftBox.style.width = `${moveLen}px`;
      // rightBox.style.width = `${box.clientWidth - moveLen - 5}px`;
      // rightBox.style.width = `calc(100% - ${moveLen + 21})px`;
    };
    document.onmouseup = function () {
      document.onmousemove = null;
      document.onmouseup = null;
      isDragging.value = false;
      resize.releaseCapture?.();
    };
    resize.setCapture?.();
    return false;
  };
};

const handleSortChange = ({ column, type }: Record<string, any>) => {
  const typeMap: Record<string, Function> = {
    asc: () => {
      filterData.value.order_by = column.field;
    },
    desc: () => {
      filterData.value.order_by = `-${column.field}`;
    },
    null: () => {
      delete filterData.value.order_by;
    },
  };
  return typeMap[type]();
};

// 展示右边内容
const handleShowInfo = (id: number, curActive = 'resourceInfo') => {
  resourceId.value = id;
  handleOutBatch();
  // curResource.value = tableData.value.find((e: any) => e.id === id);
  tableData.value?.forEach((item: any) => {
    if (item.id === id) {
      curResource.value = item;
      item.highlight = true;
    } else {
      item.highlight = false;
    }
  });

  if (isDetail.value) {
    isComponentLoading.value = true;
    active.value = curActive;
  } else {
    pagination.value.small = true;
    isDetail.value = true;
    document.getElementById('resourceLf').style.width = leftWidth.value;
    active.value = curActive;
  }
};

// 显示列表
const handleShowList = () => {
  isDetail.value = false;
  isShowLeft.value = true;
  pagination.value.small = false;
};

const showBatch = ref<boolean>(false);
// 进入批量操作
const handleShowBatch = () => {
  showBatch.value = true;
  handleShowList();
  exportDropData.value = [
    {
      value: 'all',
      label: t('全部资源'),
    },
    {
      value: 'selected',
      label: t('已选资源'),
      disabled: !selections.value.length,
      tooltips: t('请先勾选资源'),
    },
  ];
};

// 退出批量操作
const handleOutBatch = () => {
  showBatch.value = false;
  selections.value = [];
  exportDropData.value = [
    {
      value: 'all',
      label: t('全部资源'),
    },
    {
      value: 'filtered',
      label: t('已筛选资源'),
      disabled: !searchValue.value.length || !tableData.value.length,
      tooltips: t('请先筛选资源'),
    },
  ];

  tableDataKey.value = uniqueId();
};

// 版本对比
const handleShowDiff = async () => {
  try {
    const response = await getResourceVersionsList(props.apigwId, { offset: 0, limit: 10 });
    if (!response.results.length) {
      diffSourceId.value = 'current';
    } else {
      diffSourceId.value = response.results[0]?.id || '';
    }
    diffSidesliderConf.width = window.innerWidth <= 1280 ? 1040 : 1280;
    diffSidesliderConf.isShow = true;
  } catch (e) {
    Message({
      message: t('操作失败，请稍后再试！'),
      theme: 'error',
      width: 'auto',
    });
  }
};

// 处理批量编辑或删除
const handleBatchOperate = async (type: string) => {
  if (!selections.value?.length) {
    Message({
      message: t('请先勾选资源'),
      theme: 'warning',
      width: 'auto',
    });
    return;
  }

  dialogData.isShow = true;
  // 批量删除
  if (type === 'delete') {
    isBatchDelete.value = true;
    dialogData.title = t('确定要删除以下{count}个资源', { count: selections.value.length });
  } else {
    // 批量编辑
    isBatchDelete.value = false;
    dialogData.title = t('批量编辑资源（共{count}个）', { count: selections.value.length });
  }
};

// 处理导出弹窗显示
const handleExport = async ({ value }: {value: string}) => {
  switch (value) {
    case 'selected':
      exportParams.resource_ids = selections.value.map(e => e.id);
      exportParams.resource_filter_condition = undefined;
      break;
    case 'filtered':
      exportParams.resource_filter_condition = filterData.value;
      exportParams.resource_ids = undefined;
      break;
    case 'all':
      exportParams.resource_filter_condition = undefined;
      exportParams.resource_ids = undefined;
      break;
  }
  exportParams.export_type = value;
  exportDialogConfig.exportFileDocType = 'resource';
  exportDialogConfig.isShow = true;
};

// 导出下载
const handleExportDownload = async () => {
  const params = exportParams;
  const fetchMethod = exportDialogConfig.exportFileDocType === 'resource' ? exportResources : exportDocs;
  try {
    const res = await fetchMethod(props.apigwId, params);
    if (res.success) {
      Message({
        message: t('导出成功'),
        theme: 'success',
        width: 'auto',
      });
    }
    exportDialogConfig.isShow = false;
  } catch (e) {
    const error = e as Error;
    Message({
      message: error?.message || t('导出失败'),
      theme: 'error',
      width: 'auto',
    });
  }
};
// 批量编辑确认
const handleBatchConfirm = async () => {
  const ids = selections.value.map(e => e.id);
  if (isBatchDelete.value) {
    // 批量删除
    await batchDeleteResources(props.apigwId, { ids });
  } else {
    const params = {
      ids,
      is_public: batchEditData.value.isPublic,
      allow_apply_permission: batchEditData.value.allowApply,
      is_update_labels: batchEditData.value.isUpdateLabels,
      label_ids: batchEditData.value.labelIds,
    };
    // 批量编辑
    await batchEditResources(props.apigwId, params);
  }
  dialogData.isShow = false;
  batchEditData.value.isUpdateLabels = false;
  batchEditData.value.labelIds = [];
  Message({
    message: t(`${isBatchDelete.value ? '删除' : '编辑'}成功`),
    theme: 'success',
    width: 'auto',
  });
  getList();
  resetSelections();
};

const handleBatchCancel = () => {
  dialogData.isShow = false;
  batchEditData.value.isUpdateLabels = false;
};

// 处理导入跳转
const handleImport = (v: IDropList) => {
  const routerName = v.value === 'doc' ? 'apigwResourceImportDoc' : 'apigwResourceImport';
  router.push({
    name: routerName,
  });
};

// 鼠标进入
const handleMouseEnter = (e: any, row: any) => {
  setTimeout(() => {
    row.isDoc = true;
  }, 100);
};

// 鼠标离开
const handleMouseLeave = (e: any, row: any) => {
  setTimeout(() => {
    row.isDoc = false;
  }, 100);
};

// 展示文档
const handleShowDoc = (data: any, languages = 'zh') => {
  curResource.value = data;
  resourceId.value = data.id;   // 资源id
  docSliderConf.isShowDocSide = true;
  docSliderConf.title = `${t('文档详情')}【${data.name}】`;
  docSliderConf.languages = languages;
};

// 改变侧栏边title
const handleUpdateTitle = (type: string, isUpdate?: boolean) => {
  if (type === 'cancel') {
    docSliderConf.title = `${t('文档详情')}【${curResource.value.name}】`;
  } else {
    docSliderConf.title = `${isUpdate ? t('更新') : t('创建')}【${curResource.value.name}】`;
  }
};

// 处理保存成功 删除成功 重新请求列表
const handleSuccess = () => {
  getList();
  handleShowVersion();
};

// 获取资源是否需要发版本更新
const handleShowVersion = async () => {
  try {
    const res = await checkNeedNewVersion(props.apigwId);
    versionConfigs.needNewVersion = res.need_new_version;
    versionConfigs.versionMessage = res.msg;
  } catch (error: any) {
    versionConfigs.needNewVersion = false;
    versionConfigs.versionMessage = error?.msg;
  }
};

// 处理标签点击
const handleEditLabel = (data: any) => {
  resourceId.value = data.id;
  tableData.value.forEach((item: Record<string, any>) => {
    item.isEditLabel = false;
  });
  curLabelIds.value = data.labels.map((item: any) => item.id);
  curLabelIdsbackUp.value = cloneDeep(curLabelIds.value);
  data.isEditLabel = true;
};

// 生成版本功能
const handleCreateResourceVersion = async () => {
  const response = await getResourceVersionsList(props.apigwId, { offset: 0, limit: 10 });
  if (!response.results.length) {
    diffSourceId.value = 'current';
  } else {
    diffSourceId.value = response.results[0]?.id || '';
  }
  versionSidesliderRef.value.showReleaseSideslider();
};

// 获取标签数据
const getLabelsData = async () => {
  const res = await getGatewayLabels(props.apigwId);
  res.forEach((e: any) => e.isEdited = false);
  labelsData.value = res;
};

// 未做变更关闭select下拉
const handleCloseSelect = (row: any, newLabelData: any = []) => {
  tableData.value.forEach((item: Record<string, any>) => {
    item.isEditLabel = false;
  });
  // 接收新的标签数据，检查标签的 name 是否有变化，有则重新获取列表数据
  // 用于修复标签更改名称后，SelectCheckBox 组件的 update-success 不能触发，列表中的标签名没有相应更新的 bug
  if (newLabelData.length > 0) {
    const diff = differenceBy(row.labels, newLabelData, 'name');
    if (diff.length > 0) {
      getList();
      init();
    }
  }
};

// 更新成功
const handleUpdateLabelSuccess = () => {
  getList();
  init();
};

// 删除成功
const handleDeleteSuccess = () => {
  getList();
  handleShowList();
};

const handleUpdateLabelsChange = (v: Boolean) => {
  if (!v) {
    batchEditData.value.labelIds = [];
  }
};

const handleRowClass = (v: any) => {
  const ret = [];
  if (!v.is24HoursAgo) {
    ret.push('row-cls-in-24hours');
  }
  if (v.highlight) {
    ret.push('row-cls-highlight');
  }
  return ret.join(' ');
};

const tipsContent = (data: any[]) => {
  return h('div', {}, [
    data.map((item: string) => h('div', { style: 'display: flex; align-items: center', class: 'mt5 tips-cls' }, [item])),
  ]);
};

const settings = {
  trigger: 'click',
  fields: [
    { name: t('资源名称'), field: 'name', disabled: true },
    { name: t('后端服务'), field: 'backend_name' },
    { name: t('前端请求方法'), field: 'method' },
    { name: t('前端请求路径'), field: 'path' },
    { name: t('插件数'), field: 'plugin_count' },
    { name: t('文档'), field: 'docs' },
    { name: t('标签'), field: 'labels' },
    { name: t('更新时间'), field: 'updated_time' },
    { name: t('操作'), field: 'act', disabled: true },
  ],
  checked: ['name', 'backend_name', 'method', 'path', 'plugin_count', 'docs', 'labels', 'updated_time', 'act'],
};

watch(
  () => isDetail.value,
  (v) => {
    if (!v) {
      tableData.value?.forEach((item: any) => {
        item.highlight = false;
      });
    }
  },
);

watch(
  () => isShowLeft.value,
  (v) => {
    const el = document.getElementById('resourceLf');
    if (!v) {
      el.style.width = '0px';
    } else {
      el.style.width = leftWidth.value;
    }
  },
);

// 监听table数据 如果未点击某行 则设置第一行的id为资源id
watch(
  () => tableData.value,
  (v: any) => {
    if (v.length && resourceId.value === 0) {
    // if (v.length) {
      resourceId.value = v[0].id;
    }
    // 设置显示的tag值
    tableData.value.forEach((item: any) => {
      item.is24HoursAgo = is24HoursAgo(item.created_time);
      item.tagOrder = 1;
      item.labelText = item.labels?.map((label: any) => {
        return label.name;
      });
      item.isEditLabel = false;
    });

    exportDropData.value.forEach((e: IDropList) => {
      if (e.value === 'filtered') {
        e.disabled = !v.length || !searchValue.value.length;
      }
    });

    updateTableEmptyConfig();
  },
  { immediate: true },
);

// 监听导出弹窗
watch(
  () => exportDialogConfig,
  (v: IExportDialog) => {
    if (v.exportFileDocType === 'docs') {
      exportParams.file_type = 'zip';
    } else {
      exportParams.file_type = 'yaml';
    }
  },
  { deep: true },
);

// 选中的值
watch(
  () => selections.value,
  (v: number[]) => {
    exportDropData.value.forEach((e: IDropList) => {
      // 已选资源
      if (e.value === 'selected') {
        e.disabled = !v.length;
      }
    });
  },
  { immediate: true, deep: true },
);

// Search Select选中的值
watch(
  () => searchValue.value,
  (v: any[]) => {
    filterData.value = {
      order_by: filterData.value.order_by,
      keyword: '',
    };

    if (route.query?.backend_id) {
      const { backend_id } =  route?.query;
      filterData.value.backend_id = backend_id;
    } else {
      delete filterData.value.backend_id;
    }

    if (!filterData.value.order_by) {
      delete filterData.value.order_by;
    }
    pagination.value.offset = 0;
    pagination.value.current = 0;
    if (v.length) {
      v.forEach((e: any) => {
        if (e.id === e.name) {
          filterData.value.keyword = e.name;
        } else {
          if (e.id === 'method') {
            filterData.value[e.id] = e.values?.map((item: any) => item.id)?.join(',');
          } else {
            filterData.value[e.id] = e.values[0].id;
          }
        }
      });
    }
    exportDropData.value.forEach((e: IDropList) => {
      // 已选资源
      if (e.value === 'filtered') {
        e.disabled = !v.length;
      }
    });
    // curSelectMethod.value = filterData.value.method || 'ALL';
    // tableKey.value = +new Date();
    nextTick(() => {
      const choose = chooseMethod.value?.sort((a: any, b: any) => (a - b));
      const filter = filterData.value?.method?.split(',')?.sort((a: any, b: any) => (a - b));

      if (filter?.length && (choose?.join(',') !== filter?.join(','))) { // 值有变化时，同步给表头筛选
        chooseMethod.value = filterData.value?.method?.split(',');
      }

      if (!filter?.length && chooseMethod.value?.length) { // 清空筛选时，同步给表头筛选
        chooseMethod.value = [];
      }

      tableDataKey.value = uniqueId();
    });

    updateTableEmptyConfig();
  },
  { immediate: true, deep: true },
);

watch(() => route, () => {
  if (route?.query?.backend_id) {
    const { backend_id } =  route?.query;
    filterData.value.backend_id = backend_id;
  }
  if (resourceSettingStore.previousPagination) {
    nextTick(() => {
      pagination.value.current = resourceSettingStore.previousPagination.current;
      pagination.value.offset = resourceSettingStore.previousPagination.offset;
    });
  }
}, { immediate: true, deep: true });

watch(
  () => [isDetail.value, isShowLeft.value],
  () => {
    resourceVersionStore.setPageStatus({
      isDetail: isDetail.value,
      isShowLeft: isShowLeft.value,
    });
  },
);

watch(
  () => chooseLabels.value,
  (v) => {
    if (!v?.length) { // 重置
      filterData.value.label_ids = undefined;
    } else { // 选择
      const ids: string[] = [];
      v?.forEach((name: string) => {
        const tagLabel = labelsData.value?.find((label: any) => label.name === name);
        if (tagLabel?.id) {
          ids?.push(tagLabel.id);
        }
      });
      filterData.value.label_ids = ids.join(',');
    }
  },
  { deep: true, immediate: true },
);

watch(
  () => chooseMethod.value,
  (v) => {
    if (!v?.length) { // 重置
      filterData.value.method = undefined;
      searchValue.value = searchValue.value.filter((item: Record<string, any>) => !['method'].includes(item.id));
    } else { // 选择
      filterData.value.method = v?.join(',');
      const hasMethodData = searchValue.value.find((item: Record<string, any>) => ['method'].includes(item.id));
      const method = v?.map((m: string) => {
        return { id: m, name: m };
      });
      if (hasMethodData) {
        hasMethodData.values = method;
      } else {
        searchValue.value.push({
          id: 'method',
          name: t('前端请求方法'),
          values: method,
        });
      }
    }
    getList();
  },
  { deep: true, immediate: true },
);

const recoverPageStatus = () => {
  const { isDetail: d, isShowLeft: l } = resourceVersionStore.getPageStatus;
  isDetail.value = d;
  isShowLeft.value = l;

  const el = document.getElementById('resourceLf');
  if (!l) {
    el.style.width = '0px';
  } else {
    el.style.width = leftWidth.value;
  }
};

onBeforeRouteLeave((to) => {
  if (to.name === 'apigwResourceEdit') {
    const { current, offset } = pagination.value;
    resourceSettingStore.setPagination({
      current,
      offset,
    });
  } else {
    resourceSettingStore.setPagination(null);
  }
});

onMounted(() => {
  init();
  dragTwoColDiv('resourceId', 'resourceLf', 'resourceLine'/* , 'resourceRg' */);
  // 监听其他组件是否触发了资源更新，获取最新的列表数据
  mitt.on('on-update-plugin', () => {
    pagination.value = Object.assign(pagination.value, { current: 0, limit: maxTableLimit });
    getList();
    handleShowVersion();
  });
  if (route.meta.pageStatus) {
    recoverPageStatus();
  }
});

onBeforeMount(() => {
  mitt.off('on-update-plugin');
});

</script>
<style lang="scss" scoped>
.resource-container{
  display: flex;
  align-items: flex-start;
  height: calc(100% - 112px);
  .resource-container-lf,
  .resource-container-rg{
    position: relative;
  }
  .resource-container-rg {
    min-height: calc(100% + 40px);
    background: #fff;
    margin-top: -20px;
    margin-right: -24px;
    margin-bottom: -20px;
    &.dragging {
      &::before {
        content: ' ';
        position: absolute;
        z-index: 999;
        width: 2px;
        height: 100%;
        left: -1px;
        top: 0;
        background-color: #3a84ff;
      }
    }
  }
  .demarcation-button:hover + .resource-container-rg {
    &::before {
      content: ' ';
      position: absolute;
      z-index: 999;
      width: 2px;
      height: 100%;
      left: -1px;
      top: 0;
      background-color: #3a84ff;
    }
  }
  .demarcation-button {
    height: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: col-resize;
    span {
      color: #63656E;
      transform: rotate(90deg);
      padding-bottom: 6px;
    }
  }
  .operate{
    gap: 8px;

    &-input{
      width: 450px;
    }

    .search-select-wrap {
      flex-grow: 1;
      max-width: 450px;
    }
  }
  .left-wraper{
    position: relative;
    background: #fff;

    .document-info{
      color: #3a84ff;
      font-size: 12px;
      cursor: pointer;
    }
    .plus-class{
      font-size: 14px;
      font-weight: bold;
      cursor: pointer;
      color: #979BA5;
      background: #EAEBF0;
      padding: 4px;
      &:hover {
        color: #3A84FF;
        background: #E1ECFF;
      }
    }

    .table-layout{
      :deep(.row-cls-in-24hours) {
        td {
          background: #f2fff4 !important;
        }
      }
      :deep(.row-cls-highlight) {
        td {
          background: #e1ecff !important;
        }
      }
      :deep(.bk-table-head) {
        scrollbar-color: transparent transparent;
      }
      :deep(.bk-table-body) {
        scrollbar-color: transparent transparent;
      }
      :deep(.resource-name) {
        display: flex;
        align-items: center;
        .name {
          color: #3a84ff;
          overflow: hidden;
          white-space: nowrap;
          text-overflow: ellipsis;
          cursor: pointer;
          &-updated {
            max-width: 112px;
          }
        }
        .dot {
          margin-left: 4px;
          cursor: pointer;
        }
      }
    }

    .text-warp {
      position: relative;
      cursor: pointer;
      .edit-icon {
        position: absolute;
        font-size: 24px;
        cursor: pointer;
        color: #3A84FF;
        top: -2px;
        // top: 8px;
        // right: -20px;
      }
      :deep(.bk-tag-text) {
        max-width: 80px;
      }
    }
    .tag-cls{
      cursor: pointer;
    }
  }

  .toggle-button{
    width: 16px;
    height: 28px;
    background: #FAFBFD;
    border: 1px solid #3A84FF;
    box-shadow: 0 2px 4px 0 #0000001a;
    border-radius: 4px 0 0 4px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #3A84FF;
    cursor: pointer;
    font-size: 12px;
    position: absolute;
    z-index: 99;
    transform: translateY(-50%);
    .icon {
      transition: transform .15s !important;
    }
    &:hover {
      background-color: #3a84ff;
      color: #fff;
    }
    &.active {
      background-color: #3a84ff;
      color: #fff;
    }
  }
  .toggle-button-lf {
    // right: -19px;
    top: -6px;
  }
  .toggle-button-rg {
    left: -1px;
    top: 0;
    transform: rotate(180deg) !important;
    border-radius: 4px 0 0 4px;
  }
}

:deep(.bk-popover) {
  .bk-pop2-content {
    .bk-table-head-filter {
      .content-footer {
        display: none;
      }
    }
  }
}

.nest-dropdown {
  display: flex;
  flex-direction: column;
  align-items: center;
}

.super-big-button {
  padding: 5px 58px;
}

.resource-tab-panel {
  :deep(.bk-tab-header-item) {
    padding: 0 24px !important;
  }
}

.resource-container.dragging {
  cursor: col-resize;
}
.welt {
  padding-left: 0px;
}
.ag-dot {
  width: 8px;
  height: 8px;
  display: inline-block;
  vertical-align: middle;
  border-radius: 50%;
  border: 1px solid #C4C6CC;
}

.tips-cls {
  background: #f0f1f5;
  padding: 3px 8px;
  border-radius: 2px;
  cursor: default;
  &:hover {
    background: #d7d9e1 !important;
  }
}
.doc-sides {
  :deep(.bk-modal-content) {
    max-height: calc(100vh - 52px);
    overflow: hidden;
  }
}
.plugin-num {
  color: #3a84ff;
  cursor: pointer;
}
.edit-labels-container {
  .select-labels {
    margin-left: 16px;
    margin-top: 0px !important;
    display: inline-block;
    width: 240px;
  }
}
.split-line {
  width: 1px;
  height: 14px;
  background-color: #C4C6CC;
  margin-right: 8px;
  &.batch {
    margin-left: 4px;
    margin-right: 12px;
  }
}
.operate-btn-wrapper,
.batch-status {
  display: flex;
}
.operate-btn {
  .apigateway-icon {
    margin-right: 8px;
    &.icon-ag-chahao {
      font-size: 14px;
    }
  }
}
</style>
<style lang="scss">
.content-footer {
  justify-content: flex-end;
  .btn-filter-save.disabled {
    display: none !important;
  }
}
</style>
