
Create a gateway {{gateway_name}} client and call the API {{resource_name}} Example of useï¼š

### 1. Django Project

For Django projects, additional helper functions are provided in the `shortcuts` package.

#### 1.1 get_client_by_request

- Applicable scenarios: Front-end and back-end interaction, scenarios where django request can be obtained
- Encapsulation mechanism:
    - 1. Automatically get BlueKing app information from django settings (app_code=settings.BK_APP_CODE, app_secret=settings.BK_APP_SECRET)
    - 2. Automatically get the current username from django request and obtain login status from Cookies
    - 3. Check `settings.BK_API_URL_TMPL` or `BK_API_URL_TMPL` environment variables to set the endpoint (see notes)

```python
from bkapi.{{gateway_name_with_underscore}}.shortcuts import get_client_by_request

# Automatically get BlueKing app info from django settings (app_code=settings.BK_APP_CODE, app_secret=settings.BK_APP_SECRET)
client = get_client_by_request(
    request, # automatically include user information if request contains user login state
    endpoint="{{ django_settings.BK_API_URL_TMPL }}", # If settings is configured with BK_API_URL_TMPL, it will be applied automatically, otherwise replace it with the actual gateway access address
    stage="prod", # Please set this to the actual stage name, otherwise it defaults to prod
)

# Please modify the request to suit the specific scenario
client.api.{{resource_name}}(...)
```

#### 1.2 get_client_by_username

- Applicable scenarios: Scenarios where the `request` object cannot be directly obtained, such as background tasks, can call this function to read the user's last cached login state, but it may fail due to non-existent cache or invalid user state, etc.
- Encapsulation mechanism:
    - 1. Automatically get BlueKing app information from django settings (app_code=settings.BK_APP_CODE, app_secret=settings.BK_APP_SECRET)
    - 2. If bkoauth is installed (included by default in the framework), generate an access_token using the bkoauth SDK and use the access_token in the authentication header.
    - 3. Check `settings.BK_API_URL_TMPL` or `BK_API_URL_TMPL` environment variables to set the endpoint (see notes)

```python
from bkapi.{{gateway_name_with_underscore}}.shortcuts import get_client_by_username

# Automatically get BlueKing app info from django settings (app_code=settings.BK_APP_CODE, app_secret=settings.BK_APP_SECRET)
client = get_client_by_username(
    username="admin", # username
    endpoint="{{ django_settings.BK_API_URL_TMPL }}", # If settings is configured with BK_API_URL_TMPL, it will be applied automatically, otherwise replace it with the actual gateway access address
    stage="prod", # Please set this to the actual stage name, otherwise it defaults to prod
)

# Please modify the request according to the specific scenario
client.api.{{resource_name}}(...)
```

### 2. Non-Django Python Project

```python
from bkapi.{{gateway_name_with_underscore}}.client import Client

# Create gateway client
client = Client(
    endpoint="{{ django_settings.BK_API_URL_TMPL }}",
    stage="prod",  # Please set to the actual stage name, otherwise it defaults to prod
)

# Requesting gateway resources, please modify the request according to the specific scenario and the parameters remain compatible with requests
client.api.{{resource_name}}(
    data={...},  # Set request parameters
    path_params={...},  # Setting the route parameters
    params={...},  # Setting up querystring
    headers={...},  # Setting the request header
    timeout=10,  # Set the current request timeout
)
```

The above is only an example, please modify the parameters and the way they are called according to the actual use.

### 3. Note

The `endpoint` parameter when creating a gateway can be found in the specific gateway profile for the corresponding access address. If it is not set, it will automatically be probed using the following.

1. reading the `settings.BK_API_URL_TMPL` variable automatically if it is currently a Django project.
2. automatically generated by reading the `BK_API_URL_TMPL` environment variable (which is set by default in the BlueKing Developer Centre).
3. if `endpoint` is empty, the request will throw an `EndpointNotSetError` exception.


If `settings.BK_API_URL_TMPL` is not set during local development and there are no environment variables injected by the Developer Center at runtime, you need to manually set the `endpoint` parameter before starting by using `export BK_API_URL_TMPL=corresponding_environment_value` or setting it manually.

